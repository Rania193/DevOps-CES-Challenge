---
# ConfigMap for ArgoCD configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
data:
  # ArgoCD server URL
  url: https://datavisyn-argocd.duckdns.org
  
  # Dex configuration for GitHub OAuth
  # NOTE: Secret references use $key format, where 'key' must exist in 'argocd-secret'
  dex.config: |
    connectors:
      - type: github
        id: github
        name: GitHub
        config:
          clientID: $dex.github.clientID
          clientSecret: $dex.github.clientSecret
          # Uncomment to restrict to specific GitHub org:
          # orgs:
          #   - name: your-github-org

---
# ConfigMap for RBAC
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-rbac-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-rbac-cm
    app.kubernetes.io/part-of: argocd
data:
  # Policy format: p, <subject>, <resource>, <action>, <project>, allow/deny
  # Role format: g, <user>, <role>
  #
  # IMPORTANT: The username is your GitHub EMAIL, not your GitHub username!
  # Check ArgoCD UI > User Info to see your actual username.
  policy.csv: |
    # Grant admin access to specific GitHub users (by email!)
    # Replace with your GitHub email (check User Info in ArgoCD)
    g, rania.fahmy222@gmail.com, role:admin
    
    # You can add more users:
    # g, another-user@gmail.com, role:admin
    # g, readonly-user@gmail.com, role:readonly
  
  # Default policy for users not explicitly listed
  # Options: role:readonly, role:admin, or "" (no access)
  # Set to role:admin for demo/testing
  policy.default: role:admin
  
  # Map GitHub username to ArgoCD user
  scopes: "[groups, email]"

